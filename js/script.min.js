angular.module("ctcaeApp",["ionic","jett.ionic.filter.bar","ui.router"]).controller("HomeCtrl",["$scope","$timeout","$state","sharedService","$ionicScrollDelegate","$ionicFilterBar","$ionicSideMenuDelegate","$ionicLoading","$ionicPopup","$ionicListDelegate",function(e,a,t,r,n,o,s,c,l,u){function h(){return{en:'<i class="icon ion-ios-checkmark color-checkmark head"></i>'+e.shareData.local.en.flagged+" ("+e.shareData.flagNum+")",ja:'<i class="icon ion-ios-checkmark color-checkmark head"></i>'+e.shareData.local.ja.flagged+" ("+e.shareData.flagNum+")"}}function f(){var a=indexedDB.open(p);a.onupgradeneeded=function(e){var a=e.target.result;a.createObjectStore(b,{keyPath:"id"})},a.onsuccess=function(a){var t=a.target.result,r=t.transaction(b,"readonly"),n=r.objectStore(b),o=n.get("flags");o.onsuccess=function(a){try{e.shareData.flags=a.target.result.contents,e.shareData.flagNum=Object.keys(e.shareData.flags).length}catch(e){console.log("error",e)}},o.onerror=function(e){console.log("db not exist")}},a.onerror=function(a){e.shareData.putDb(e.shareData.flags)}}function g(e){var a=indexedDB.deleteDatabase(e);a.onsuccess=function(e){console.log("db delete success")},a.onerror=function(){console.log("db delete error")}}function m(){var e=!1;if(e=bowser.safari?bowser.check({safari:"11.1"}):bowser.ios?bowser.check({ios:"11.3"}):bowser.chrome?bowser.check({chrome:"45"}):!!bowser.android||(bowser.msedge?bowser.check({msedge:"17"}):bowser.firefox?bowser.check({firefox:"44"}):!!bowser.opera&&bowser.check({opera:"32"})),!e){var a=l.alert({title:"Browser not supported",template:"Your browser may not be compatible fully. Please consider to use the latest version of Chrome, Safari, Firefox or Edge.",okText:"Dismiss"});a.then(function(e){console.log("")})}}e.shareData=r,e.shareData.flags||(e.shareData.flags={}),e.shareData.secondaryOn=!0,e.$on("$ionicView.beforeLeave",function(e){try{document.getElementById("filterBar").style.display="none"}catch(e){console.log(e)}}),e.$on("$ionicView.beforeEnter",function(a){try{e.shareData.flagNum=Object.keys(e.shareData.flags).length,document.getElementById("filterBar").style.display="inherit"}catch(a){console.log(a)}}),e.$on("$ionicView.afterEnter",function(){var t=function(){var e,a,t=window.navigator,r=["language","browserLanguage","systemLanguage","userLanguage"];if(Array.isArray(t.languages))for(e=0;e<t.languages.length;e++)if(a=t.languages[e],a&&a.length)return a;for(e=0;e<r.length;e++)if(a=t[r[e]],a&&a.length)return a;return null};a(function(){e.shareData.secondaryOn?e.shareData.lang||("ja"===t()?(e.shareData.lang="ja",e.shareData.langJa=!0):(e.shareData.lang="en",e.shareData.langJa=null)):(e.shareData.lang="en",e.shareData.langJa=null)})}),e.freezeScroll=function(){n.$getByHandle("mainScroll").getScrollView().options.scrollingY=!1},e.enableScroll=function(){n.$getByHandle("mainScroll").getScrollView().options.scrollingY=!0},e.shareData.local={en:{all:"All",flagged:"Checked",back:"Back",search:"Search",cancel:"Cancel",def:"Definition",nav:"Navigational Note"},ja:{all:"すべて",flagged:"チェック付き",back:"戻る",search:"検索",cancel:"キャンセル",def:"定義",nav:"検索上の注意"}},e.shareData.aeList=ctcae,e.socTitle={en:e.shareData.local.en.all,ja:e.shareData.local.ja.all},e.shareData.socList=e.shareData.aeList.map(function(e){return{soc:e.soc,socja:e.socja}}).filter(function(e,a,t){return t.map(function(e){return e.soc}).indexOf(e.soc)===a});var D=[];for(i in e.shareData.socList){var d=ctcae.map(function(e){return e.soc}).indexOf(e.shareData.socList[i].soc);D.unshift(d)}for(i in D)e.shareData.aeList.splice(D[i],0,{term:e.shareData.aeList[D[i]].soc,soc:!1,termja:e.shareData.aeList[D[i]].socja,socja:!1});e.getItemHeight=function(e){return e.soc?44:30},e.shareData.changeLang=function(){e.shareData.secondaryOn?"ja"===e.shareData.lang?e.shareData.lang="en":(e.shareData.lang="ja",e.shareData.langJa=!0):e.shareData.lang="en"},e.showFilterBar=function(){s.isOpen()&&s.toggleLeft(),filterBarInstance=o.show({cancel:function(){e.shareData.search=""}})},e.shareData.getAe=function(){if(e.shareData.search){var a=String(e.shareData.search).split("").every(function(e){return e.charCodeAt()<256});return console.log("english",a),!a&&e.shareData.secondaryOn?(e.shareData.lang="ja",e.shareData.langJa=!0,e.shareData.target=e.shareData.aeList.filter(function(a,t,r){return!a.soc||["meddra","termja","g1ja","g2ja","g3ja","g4ja","g5ja","defja","navja"].some(function(t){return a[t].toLowerCase().indexOf(e.shareData.search.toLowerCase())>-1})})):(e.shareData.lang="en",e.shareData.target=e.shareData.aeList.filter(function(a,t,r){return!a.soc||["meddra","term","g1","g2","g3","g4","g5","def","nav"].some(function(t){return a[t].toLowerCase().indexOf(e.shareData.search.toLowerCase())>-1})})),e.shareData.target.filter(function(e,a,t){try{return!e.soc&&e.term===t[a+1].soc||e.soc}catch(e){console.log("no data in a category")}})}return e.shareData.aeList},e.shareData.encode=function(a,t){try{if(t)var r=String(a[t+("ja"===e.shareData.lang?"ja":"")]);else r=String(a[t]);for(var n=String(r).length,o=[];n--;){var s=r[n].charCodeAt();'"'===r[n]?o[n]="&quot;":"&"===r[n]?o[n]="&amp;":o[n]=62===s?"&gt;":60===s?"&lt;":r[n]}return o.join("")}catch(e){console.log(e)}},e.scrollTop=function(){n.scrollTop(!1)},e.toggleLeft=function(){n.scrollTop(!1),e.shareData.search="",s.toggleLeft(),e.shareData.flagNum=Object.keys(e.shareData.flags).length},e.shareData.flagging=function(a,t){t.preventDefault(),t.stopPropagation(),e.shareData.flags[a]?delete e.shareData.flags[a]:e.shareData.flags[a]=!0,e.shareData.putDb(e.shareData.flags),e.shareData.flagNum=Object.keys(e.shareData.flags).length,e.socTitle.en.includes("ion-ios-checkmark")&&(e.socTitle=h())},e.getItem=function(r,n){r?(e.shareData.detail=e.shareData.aeList.filter(function(e){return e.meddra===r}),t.go("tabs.detail")):n.preventDefault(),a(function(){u.closeOptionButtons()},300)},e.getSoc=function(t,r){r?(e.socTitle={en:t.soc,ja:t.socja},e.shareData.aeList=ctcae.filter(function(e){return e.soc===t.soc}),e.shareData.aeList.unshift({term:t.soc,soc:!1,termja:t.socja,socja:!1})):(e.socTitle={en:e.shareData.local.en.all,ja:e.shareData.local.ja.all},e.shareData.aeList=ctcae),s.toggleLeft(),a(function(){n.scrollTop(!1),u.closeOptionButtons()},300)},e.getFlag=function(){var t=Object.keys(e.shareData.flags);e.shareData.aeList=ctcae.filter(function(e){for(i in this)if(this[i]===e.meddra)return e},t);var r=e.shareData.aeList.map(function(e){return e.soc}).filter(function(e,a,t){return t.indexOf(e)===a}),o=[];for(i in r){var c=e.shareData.aeList.map(function(e){return e.soc}).indexOf(r[i]);o.unshift(c)}for(i in o)e.shareData.aeList.splice(o[i],0,{term:e.shareData.aeList[o[i]].soc,soc:!1,termja:e.shareData.aeList[o[i]].socja,socja:!1});e.socTitle=h(),s.toggleLeft(),a(function(){n.scrollTop(!1)},300)};var p="ctcaeDB",b="flagStore";e.shareData.putDb=function(e){var a=indexedDB.open(p);a.onsuccess=function(a){var t=a.target.result,r=t.transaction(b,"readwrite"),n=r.objectStore(b),o=n.put({id:"flags",contents:e});o.onsuccess=function(){console.log("put data success")},r.oncomplete=function(){console.log("transaction completed")},t.close()},a.onerror=function(e){console.log("db open error")}},f(),e.shareData.dbremove=function(e){g(e)},e.removeFlags=function(){var a=l.confirm({title:"Uncheck All",template:"Are you sure you want to uncheck all checkmarks?",okText:"Uncheck",okType:"button-assertive"});a.then(function(a){if(a){var t={};e.shareData.flags=t,e.shareData.putDb(t),e.shareData.flagNum=0,e.socTitle=h(),u.closeOptionButtons()}else console.log("You are not sure")})},m()}]).controller("DetailCtrl",["$scope","sharedService",function(e,a){e.shareData=a,e.shareData.ok=function(){alert("g")}}]).controller("SearchCtrl",["$scope","sharedService",function(e,a){e.shareData=a}]).controller("PsCtrl",["$scope","sharedService",function(e,a){e.shareData=a,e.$on("$ionicView.enter",function(e){try{document.getElementById("filterBar").style.display="none"}catch(e){console.log(e)}})}]).controller("InfoCtrl",["$scope","sharedService","$ionicPopup",function(e,a,t){e.shareData=a,e.$on("$ionicView.enter",function(e){try{document.getElementById("filterBar").style.display="none"}catch(e){console.log(e)}}),e.shareData.removeFlags=function(){var a=t.confirm({title:"Uncheck All",template:"Are you sure you want to uncheck all checkmarks?",okText:"Uncheck",okType:"button-assertive"});a.then(function(a){if(a){var t={};e.shareData.flags=t,e.shareData.putDb(t)}else console.log("You are not sure")})},e.shareData.unregister=function(){var e=t.confirm({title:"Unregister / Remove Cashe",template:"Are you sure you want to unregister Service Worker and remove Cashe?"});e.then(function(e){e?swUnregister():console.log("You are not sure")})}}]).config(["$stateProvider","$urlRouterProvider","$ionicFilterBarConfigProvider",function(e,a,t){e.state("tabs",{url:"/tabs",abstract:!0,templateUrl:"tabs.html"}).state("tabs.home",{url:"/home",views:{"tabs-home":{templateUrl:"templates/home.min.html"}}}).state("tabs.detail",{url:"/detail",views:{"tabs-home":{templateUrl:"templates/detail.min.html"}}}).state("tabs.info",{url:"/info",views:{"tabs-info":{templateUrl:"templates/info.min.html"}}}).state("tabs.privacy",{url:"/privacy",views:{"tabs-info":{templateUrl:"templates/privacy.min.html"}}}).state("tabs.term",{url:"/term",views:{"tabs-info":{templateUrl:"templates/term.min.html"}}}).state("tabs.third",{url:"/third",views:{"tabs-info":{templateUrl:"templates/third.min.html"}}}).state("tabs.about",{url:"/about",views:{"tabs-about":{templateUrl:"templates/about.min.html"}}}).state("tabs.install",{url:"/install",views:{"tabs-info":{templateUrl:"templates/install.min.html"}}}),a.otherwise("/tabs/home"),t.backdrop(!0)}]).factory("sharedService",function(){return{text:"sharedService"}}).filter("highlight",["$sce",function(e){return function(a,t){function r(e){for(var a=e.length,t=[];a--;){var r=e[a].charCodeAt();'"'===e[a]?t[a]="&quot;":"&"===e[a]?t[a]="&amp;":t[a]=62===r?"&gt;":60===r?"&lt;":e[a]}return t.join("")}function n(e){for(var a=e.length,t=[];a--;)["[","\\","^","$",".","|","?","*","+","(",")"].some(function(t){return t===e[a]})?t[a]="\\"+e[a]:t[a]=e[a];return t.join("")}return a&&t&&(a=a.replace(new RegExp("("+n(r(t))+")","gi"),'<span class="highlighted">$1</span>')),e.trustAsHtml(a?a.replace(/\n/g,"<br />"):"")}}]).config(["$ionicConfigProvider",function(e){e.navBar.positionPrimaryButtons("left"),e.tabs.position("bottom"),e.tabs.style("standard"),e.navBar.alignTitle("left"),e.backButton.text(""),e.backButton.previousTitleText("")}]);